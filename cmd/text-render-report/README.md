# PDF文字渲染诊断工具集

这个目录包含了一系列用于诊断PDF文字渲染问题的测试工具。

## 工具列表

### 1. check-png - PNG文件基础分析
**位置**: `cmd/check-png/main.go`

**功能**:
- 分析PNG图片的基本信息（尺寸、类型）
- 统计像素颜色分布
- 检测黑色像素（文字）和非白色像素
- 分析内容的行列分布
- 提供诊断结论

**使用方法**:
```bash
go run cmd/check-png/main.go test/test_preview/page_1.png
```

**输出示例**:
- 图片尺寸和类型
- 像素统计（总数、非白色、黑色）
- 前10种最常见颜色
- 内容区域的行列范围
- 诊断结论

---

### 2. scan-text-rows - 文字行扫描
**位置**: `cmd/scan-text-rows/main.go`

**功能**:
- 扫描图片前200行
- 统计每行的黑色像素数量
- 显示黑色像素的X坐标范围

**使用方法**:
```bash
go run cmd/scan-text-rows/main.go test/test_preview/page_1.png
```

**输出示例**:
```
行 125:  304 个黑色像素, X范围 [  93, 1237]
行 126:  309 个黑色像素, X范围 [  93, 1239]
```

---

### 3. inspect-pixels - 像素详细检查
**位置**: `cmd/inspect-pixels/main.go`

**功能**:
- 检查特定行（125-131行）的像素详情
- 显示黑色像素的具体位置
- 显示每个黑色像素周围的RGB值
- 用于分析抗锯齿效果

**使用方法**:
```bash
go run cmd/inspect-pixels/main.go test/test_preview/page_1.png
```

**输出示例**:
```
第 125 行:
  黑色像素数: 304
  前10个位置: 93 154 204 205 206 224 225 226 260 261
  前5个黑色像素周围的RGB值:
    位置 93: (250,246,234) (156,153,146) (0,0,0) (105,103,98) (250,246,234)
```

---

### 4. text-render-report - 综合诊断报告 ⭐
**位置**: `cmd/text-render-report/main.go`

**功能**:
- 生成完整的文字渲染诊断报告
- 统计黑色、灰色、非白色像素
- 分析文字行覆盖率
- 评估抗锯齿效果
- 提供诊断结论和建议

**使用方法**:
```bash
go run cmd/text-render-report/main.go test/test_preview/page_1.png
```

**输出示例**:
```
===========================================
     PDF文字渲染诊断报告
===========================================

文件: test/test_preview/page_1.png
尺寸: 1240 x 1754 像素

【像素统计】
  总像素数:     2174960
  黑色像素:     21830 (1.00%) - 纯文字
  灰色像素:     37978 (1.75%) - 抗锯齿
  非白色像素:   1058060 (48.65%) - 总内容

【文字行分析】
  有文字的行:   362 / 1754 (20.6%)
  空白行:       1392 / 1754 (79.4%)

【抗锯齿分析】
  检查第126行（文字密集区）的抗锯齿效果:
    黑色像素: 309
    灰色像素: 103
    抗锯齿比: 0.33 (灰色/黑色)

【诊断结论】
  ✓ 文字已成功渲染
     检测到 21830 个黑色像素
  ✓ 有抗锯齿效果
     文字边缘有一定平滑处理
  ✓ 文字覆盖率正常 (20.6%)
```

---

## 诊断结果总结

根据对 `test/test_preview/page_1.png` 的分析：

### ✅ 正常情况
1. **文字已成功渲染**: 检测到 21,830 个黑色像素
2. **抗锯齿效果正常**: 有 37,978 个灰色像素用于平滑文字边缘
3. **文字覆盖率**: 20.6% 的行包含文字内容
4. **内容分布**: 文字主要分布在第0-1585行，横跨整个页面宽度

### 📊 关键数据
- 图片尺寸: 1240 x 1754 像素
- 黑色像素: 21,830 (1.00%)
- 灰色像素: 37,978 (1.75%)
- 抗锯齿比: 约 0.33 (灰色/黑色)
- 文字行数: 362 行

### 🔍 发现的问题
从像素分析来看，文字渲染是正常的。如果用户报告看不到文字，可能的原因：

1. **背景色问题**: 大量非白色像素（48.65%）可能是背景色或图片
2. **对比度问题**: 黑色像素占比较低（1%），可能在某些显示器上不够明显
3. **字体大小**: 需要检查字体是否过小
4. **图层问题**: 文字可能被其他元素覆盖

### 💡 建议
1. 使用 `scan-text-rows` 查看具体哪些行有文字
2. 使用 `inspect-pixels` 检查文字周围的颜色值
3. 检查PDF原文件的字体设置
4. 验证渲染参数（DPI、缩放比例等）

---

## 开发说明

这些工具都是独立的Go程序，可以直接运行，无需编译。它们使用标准库的 `image/png` 包来解析PNG文件。

### 添加新的诊断工具
1. 在 `cmd/` 下创建新目录
2. 编写 `main.go` 文件
3. 使用 `go run` 直接运行

### 扩展现有工具
可以修改这些工具来：
- 支持更多图片格式（JPEG、WebP等）
- 添加更多统计指标
- 生成可视化报告
- 批量处理多个文件
